---
import type {
  ResumeCore,
  ResumeLensConfig,
  ResumeProject,
  ResumeSkillModule,
  ResumeExperience,
  ResumeEducation,
} from "../../data/resume/types";

type Props = {
  core: ResumeCore;
  lens: ResumeLensConfig;
  projects: ResumeProject[];
  skills: ResumeSkillModule[];
  experience: ResumeExperience[];
  education: ResumeEducation[];
  mode?: "web" | "print";
  showLens?: boolean;
};

const { core, lens, projects, skills, experience, education, mode = "web", showLens = false } = Astro.props as Props;

const linkText = (label: string, href: string) => (mode === "print" ? href : label);
---

<section class="py-16">
  <div class="container mx-auto px-8 max-w-3xl">
    <header class="space-y-2">
      <h1 class="text-4xl font-black">{core.name}</h1>
      <p class="text-lg">
        {core.title}
        {core.location ? ` 路 ${core.location}` : ""}
      </p>

      {/* Resume links (web vs PDF modes) */}
      <div class="resume-links resume-links__row">
        <div class="resume-link">
          <span class="font-semibold link-pdf">Email:</span>
          <a href={`mailto:${core.email}`}>
            {mode === "print" ? core.email : "Email"}
          </a>
        </div>

        <span class="resume-links__sep link-pdf">路</span>

        <div class="resume-link">
          <span class="font-semibold link-pdf">Portfolio:</span>
          <a href={core.links.portfolio}>
            {mode === "print" ? core.links.portfolio : "Portfolio"}
          </a>
        </div>
      </div>

      {showLens && <p class="text-sm text-gray-600 dark:text-gray-300 mt-2">Lens: {lens.label}</p>}
    </header>

    {
      core.sectionOrder.includes("summary") && (
        <section class="mt-10">
          <h2 class="text-xl font-bold">Summary</h2>
          <ul class="mt-3 list-disc pl-5 space-y-1">
            {core.summary.map((line) => (
              <li>{line}</li>
            ))}
          </ul>
        </section>
      )
    }

    {
      core.sectionOrder.includes("skills") && (
        <section class="mt-10">
          <h2 class="text-xl font-bold">Skills</h2>

          <div class="skills-grid mt-4 grid gap-4 sm:grid-cols-2">
            {skills.map((m) => (
              <div class="skills-card rounded-lg border border-gray-200 dark:border-gray-700 p-4">
                <h3 class="font-semibold leading-tight">{m.label}</h3>
                <ul class="list-disc pl-5 space-y-1 text-sm">
                  {m.bullets.slice(0, 2).map((b) => (
                    <li>{b}</li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </section>
      )
    }

    {
      core.sectionOrder.includes("projects") && (
        <section class="mt-10">
          <h2 class="text-xl font-bold">Projects</h2>

          <div class="mt-4 space-y-6">
            {projects.map((p) => (
              <article class="rounded-lg border border-gray-200 dark:border-gray-700 p-5">
                <div class="flex flex-col gap-2">
                  <div class="flex items-baseline justify-between gap-4 flex-wrap">
                    <h3 class="text-lg font-semibold">{p.title}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-300">{p.stackLine}</p>
                  </div>

                  <ul class="mt-2 list-disc pl-5 space-y-1">
                    {p.bullets.slice(0, 3).map((b) => (
                      <li>{b}</li>
                    ))}
                  </ul>

                  {mode === "web" && p.links?.live && (
                    <div class="project-links">
                      <div class="project-links__row">
                        {p.links?.repo && (
                          <a class="project-link" href={p.links.repo}>
                            Repo
                          </a>
                        )}
                        <a class="project-link" href={p.links.live}>
                          Live demo
                        </a>
                      </div>
                    </div>
                  )}
                </div>
              </article>
            ))}
          </div>
        </section>
      )
    }

    {
      core.sectionOrder.includes("experience") && (
        <section class="mt-10">
          <h2 class="text-xl font-bold">Experience</h2>

          <div class="mt-4 space-y-6">
            {experience.map((r) => (
              <article class="rounded-lg border border-gray-200 dark:border-gray-700 p-5">
                <div class="flex flex-col gap-1">
                  <div class="flex items-baseline justify-between gap-4 flex-wrap">
                    <h3 class="text-lg font-semibold">
                      {r.role} 路 {r.company}
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-300">{r.period}</p>
                  </div>

                  {r.location && <p class="text-sm text-gray-600 dark:text-gray-300">{r.location}</p>}

                  <ul class="mt-2 list-disc pl-5 space-y-1">
                    {r.bullets.map((b) => (
                      <li>{b}</li>
                    ))}
                  </ul>
                </div>
              </article>
            ))}
          </div>
        </section>
      )
    }

    {
      core.sectionOrder.includes("education") && (
        <section class="mt-10 resume-education">
          <h2 class="text-xl font-bold">Education</h2>

          <div class="mt-4 space-y-6">
            {education.map((e) => (
              <article class="education-item rounded-lg border border-gray-200 dark:border-gray-700 p-5">
                <div class="flex flex-col gap-1">
                  {/* Line 1: Credential only */}
                  <div class="flex items-baseline justify-between gap-4 flex-wrap">
                    <h3 class="text-md font-semibold">{e.credential}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-300">{e.period}</p>
                  </div>

                  <p class="text-sm text-gray-600 dark:text-gray-300">
                    {e.institution}
                    {e.location ? ` 路 ${e.location}` : ""}
                  </p>

                  {/* Optional extra notes (keep web richer, print tighter) */}
                  {(e.notes?.length ?? 0) > 1 && mode !== "print" && (
                    <ul class="-mt-1 list-disc pl-5 space-y-1">
                      {(e.notes ?? []).slice(1).map((n) => (
                        <li>{n}</li>
                      ))}
                    </ul>
                  )}
                </div>
              </article>
            ))}
          </div>
        </section>
      )
    }
  </div>
</section>
