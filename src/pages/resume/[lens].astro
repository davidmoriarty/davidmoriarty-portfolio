---
// src/pages/resume/[lens].astro
import ResumeLayout from "../../layouts/ResumeLayout.astro";
import ResumeView from "../../components/resume/ResumeView.astro";

import { resumeCore } from "../../data/resume/core";
import { resumeLenses } from "../../data/resume/lenses";
import { resumeProjects } from "../../data/resume/projects";
import { resumeSkillModules } from "../../data/resume/skills";
import { resumeExperience } from "../../data/resume/experience";
import { resumeEducation } from "../../data/resume/education";
import { isDefined } from "../../data/resume/utils";

export async function getStaticPaths() {
  return resumeLenses.map((l) => ({
    params: { lens: l.id },
  }));
}

const { lens: lensId } = Astro.params;

const lens = resumeLenses.find((l) => l.id === lensId);
if (!lens) throw new Error(`Resume lens not found: ${lensId}`);

const selectedProjects = lens.recommended.projects
  .map((id) => resumeProjects.find((p) => p.id === id))
  .filter(isDefined);

const selectedSkills = lens.recommended.skillModules
  .map((id) => resumeSkillModules.find((m) => m.id === id))
  .filter(isDefined);
---

<ResumeLayout title={`Resume — ${lens.label}`} mode="web">
  <div class="resume__toggle">
    <a href={`/resume/${lens.id}/print`}>Switch to PDF view</a>
    <span> · </span>
    <a href={`/cover-letter/${lens.id}`}>Cover letter</a>
  </div>

  <ResumeView
    core={resumeCore}
    lens={lens}
    skills={selectedSkills}
    projects={selectedProjects}
    experience={resumeExperience}
    education={resumeEducation}
    mode="web"
    showLens={true}
  />
</ResumeLayout>
